name: Deploy on Tag

on:
  push:
    tags:
      - 'v*'

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set up SSH key
      uses: webfactory/ssh-agent@v0.5.3
      with:
        ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}
    
    - name: List files
      run: ls -la

    - name: Accept Server Host Key
      run: ssh-keyscan -H notenmanager.online >> ~/.ssh/known_hosts

    - name: Deploy to server
      run: rsync -av --exclude-from='deploy_ignore.txt' ./ notenman@notenmanager.online:public_html/
